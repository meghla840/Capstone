<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QuickAid — Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
:root{
  --brand:#49465b; 
  --muted:#6b7280; 
  --bg:#f3f6f9; 
  --card:#ffffff; 
  --accent:#2563eb;
  --header-gradient: linear-gradient(90deg, #49465b, #6e6c80);
}
*{box-sizing:border-box;}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); margin:0; color:#0f172a;}
header{
  background:var(--header-gradient);
  color:white;
  padding:18px 20px;
  position:sticky; top:0;
  z-index:40;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
}
header .back{font-size:20px; cursor:pointer; position:absolute; left:20px;}
header h1{font-size:18px; margin:0; font-weight:600;}
.container{max-width:1100px; margin:26px auto; padding:0 18px;}
.grid{display:grid; grid-template-columns:320px 1fr; gap:22px;}

/* LEFT PANEL */
.card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.06);}
.avatar{display:flex; align-items:center; gap:14px;}
.avatar img{width:86px; height:86px; border-radius:50%; object-fit:cover; border:3px solid #fff; box-shadow:0 6px 18px rgba(9,10,11,0.06);}
.avatar h2{margin:0; font-size:18px;}
.role-badge{display:inline-block; background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius:999px; font-weight:600; font-size:12px;}
.meta{margin-top:12px; color:var(--muted); font-size:14px;}
.left-actions{display:flex; gap:10px; margin-top:16px; flex-wrap:wrap;}
.btn{background:var(--header-gradient); color:white; border:none; padding:10px 12px; border-radius:9px; cursor:pointer; font-weight:600; transition:0.3s;}
.btn:hover{opacity:0.85;}
.btn.ghost{background:transparent; color:white; border:1px solid rgba(255,255,255,0.5);}
.gradient-btn{background: var(--header-gradient); color: white;}
.gradient-btn:hover{opacity:0.85;}

/* RIGHT PANEL */
.section{margin-bottom:18px;}
.section h3{margin:0 0 10px; font-size:16px;}
label{display:block; font-size:13px; margin-bottom:6px; color:var(--muted);}
input[type="text"], input[type="email"], input[type="tel"], input[type="number"], select, textarea{width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e9ef; font-size:14px;}
textarea{min-height:90px; resize:vertical;}
.grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
.field-list{display:flex; flex-direction:column; gap:12px; margin-top:4px;}
.hospital-card, .pharmacy-card{background:#f9f9f9; border:1px solid #e6e9ef; padding:10px 12px; border-radius:8px; display:grid; grid-template-columns:1fr 1fr; gap:10px; align-items:center;}
.add-btn{background:var(--header-gradient); color:white; font-size:13px; padding:6px 10px; border-radius:8px; cursor:pointer; border:none; margin-top:6px; transition:0.3s;}
.add-btn:hover{opacity:0.85;}

/* MESSAGE CARD */
#msgCard{display:none; margin-top:12px;}
#msgCard .msg-inner{
  background:#fff; border:1px solid #e5e7eb; border-left:4px solid var(--accent); border-radius:10px; padding:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
#msgCard .msg-inner.success{border-left-color:#16a34a; color:#166534;}
#msgCard .msg-inner.error{border-left-color:#b91c1c; color:#b91c1c;}

/* responsive */
@media(max-width:900px){.grid{grid-template-columns:1fr;} .avatar img{width:76px;height:76px;} .hospital-card,.pharmacy-card{grid-template-columns:1fr; gap:6px;}}

/* small helper */
.kv {margin:6px 0;}
.kv strong{display:inline-block; width:140px; color:#374151;}
</style>
</head>
<body>

<header>
  <div class="back" onclick="history.back()"><i class="bi bi-arrow-left"></i></div>
  <h1>Profile</h1>
</header>

<main class="container">
  <div class="grid">
    <!-- LEFT: Summary -->
    <aside class="card">
      <div class="avatar">
        <img id="profilePic" src="https://via.placeholder.com/100" alt="avatar">
        <div style="flex:1">
          <h2 id="displayName">—</h2>
          <div class="role-badge" id="displayRole">—</div>
          <div class="meta" id="displayEmail">—</div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="small"><strong>Phone:</strong> <span id="displayPhone">—</span></div>
        <div class="small" id="extraFields"></div>
      </div>

      <div class="left-actions">
        <button class="btn" id="editBtn"><i class="bi bi-pencil"></i>&nbsp; Edit Profile</button>
        <button class="btn" id="dashboardBtn"><i class="bi bi-speedometer2"></i>&nbsp; Dashboard</button>
        <button class="btn gradient-btn" id="logoutBtn"><i class="bi bi-box-arrow-right"></i>&nbsp; Logout</button>
        <button class="btn gradient-btn" id="deleteBtn"><i class="bi bi-trash"></i>&nbsp; Delete Account</button>
      </div>

      <!-- Inline Delete Confirmation Card -->
      <div id="deleteCard" style="display:none; margin-top:12px;">
        <div style="background:#fff; border:1px solid #e5e7eb; border-left:4px solid #b91c1c; border-radius:10px; padding:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
          <h4 style="margin:0 0 8px; color:#b91c1c; font-size:16px;">Delete Account?</h4>
          <p style="margin:0 0 12px; font-size:14px; color:#374151;">Are you sure you want to delete your account? This action cannot be undone.</p>
          <div style="display:flex; gap:10px;">
            <button id="confirmDeleteInline" style="background:#b91c1c; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">Yes, Delete</button>
            <button id="cancelDeleteInline" style="background:#e5e7eb; color:#1f2937; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Inline Message Card -->
      <div id="msgCard"><div class="msg-inner"></div></div>
    </aside>

    <!-- RIGHT: Profile Form -->
    <section>
      <div class="card section" id="profileFormCard">
        <h3>Profile Details</h3>

        <div class="grid-2">
          <div>
            <label>Full name</label>
            <input type="text" id="inpName" placeholder="Full name">
          </div>
          <div>
            <label>Role</label>
            <input type="text" id="inpRole" readonly>
          </div>
        </div>

        <div class="grid-2" style="margin-top:12px">
          <div>
            <label>Phone</label>
            <input type="tel" id="inpPhone">
          </div>
          <div>
            <label>Email (readonly)</label>
            <input type="email" id="inpEmail" readonly>
          </div>
        </div>

        <div id="roleFieldsContainer" style="margin-top:12px"></div>

        <div style="margin-top:12px">
          <label>Profile picture</label>
          <input type="file" id="inpPic" accept="image/*">
        </div>

        <div style="margin-top:12px; display:flex; gap:10px">
          <button class="btn" id="saveProfile">Save Profile</button>
          <button class="btn" id="cancelEdit">Cancel</button>
        </div>
      </div>
    </section>
  </div>
</main>

<script>
// ------------------- LocalStorage helpers -------------------
function readUsers(){ return JSON.parse(localStorage.getItem('quickAidUsers')||'[]'); }
function saveUsers(u){ localStorage.setItem('quickAidUsers', JSON.stringify(u)); }
function getCurrentId(){ return localStorage.getItem('quickAidCurrent'); }

let users = readUsers();
let currentId = getCurrentId();
let currentUser = users.find(u=>u.id===currentId);

// Support older/newer join pages that might have used 'userId' as key
if(!currentUser && currentId){
  currentUser = users.find(u=>u.userId===currentId || u.id===currentId);
}

// If admin login for first time, pre-add admin (keep same behavior)
if(!users.some(u=>u.role==='admin')){
  const admin = { id:'admin_1', name:'Admin', email:'admin@quickaid.com', phone:'0000000000', role:'admin', password:'admin123' };
  users.push(admin);
  saveUsers(users);
  if(!currentUser){
    currentUser = admin;
    localStorage.setItem('quickAidCurrent', admin.id);
  }
}

if(!currentUser){
  alert('No active user. Please login.');
  window.location.href='join.html';
}

// ------------------- UI Elements -------------------
const displayName = document.getElementById('displayName');
const displayRole = document.getElementById('displayRole');
const displayEmail = document.getElementById('displayEmail');
const displayPhone = document.getElementById('displayPhone');
const extraFields = document.getElementById('extraFields');
const profilePic = document.getElementById('profilePic');

const inpName = document.getElementById('inpName');
const inpRole = document.getElementById('inpRole');
const inpPhone = document.getElementById('inpPhone');
const inpEmail = document.getElementById('inpEmail');
const inpPic = document.getElementById('inpPic');
const roleFieldsContainer = document.getElementById('roleFieldsContainer');

const editBtn = document.getElementById('editBtn');
const saveProfileBtn = document.getElementById('saveProfile');
const cancelEditBtn = document.getElementById('cancelEdit');
const dashboardBtn = document.getElementById('dashboardBtn');

const logoutBtn = document.getElementById('logoutBtn');
const deleteBtn = document.getElementById('deleteBtn');

const deleteCard = document.getElementById('deleteCard');
const confirmDeleteInline = document.getElementById('confirmDeleteInline');
const cancelDeleteInline = document.getElementById('cancelDeleteInline');

const msgCard = document.getElementById('msgCard');
const msgInner = msgCard.querySelector('.msg-inner');

// ------------------- Utility: safe getter for transport/driver fields -------------------
function getDriverField() {
  // return an object mapping canonical keys -> possible existing values
  return {
    driverName: currentUser.driverName || currentUser.name || currentUser.transportName || currentUser.fullName || '',
    vehicleType: currentUser.vehicleType || currentUser.driverType || currentUser.vehicleType || '',
    numberPlate: currentUser.numberPlate || currentUser.vehicleNumber || currentUser.vehicleNo || '',
    drivingLicense: currentUser.drivingLicense || currentUser.licenseNumber || currentUser.license || '',
    nidNumber: currentUser.nidNumber || currentUser.nid || '',
    address: currentUser.address || currentUser.transportAddress || currentUser.addr || ''
  };
}

// ------------------- Functions -------------------
function showMessage(text, type='success'){
  msgInner.textContent = text;
  msgInner.className = 'msg-inner ' + type;
  msgCard.style.display='block';
  msgCard.scrollIntoView({behavior:'smooth'});
  setTimeout(()=>{ msgCard.style.display='none'; }, 4000);
}

function refreshSummary(){
  displayName.textContent = currentUser.name||currentUser.driverName||'—';
  displayRole.textContent = (currentUser.role||'patient').toUpperCase();
  displayEmail.textContent = currentUser.email||'—';
  displayPhone.textContent = currentUser.phone||'—';
  profilePic.src = currentUser.profilePic||profilePic.src;

  let html='';

  if(currentUser.role==='admin'){
    html=`<div><strong>Admin Access:</strong> Full system privileges</div>
          <div><strong>Total Users:</strong> ${users.length}</div>
          <div><strong>Users List:</strong>
            <ul style="margin:4px 0 0 16px;">${users.map(u=>`<li>${u.name || u.driverName || '—'} (${u.role})</li>`).join('')}</ul>
          </div>`;
  }
  else if(currentUser.role==='doctor'){
    html=`<div><strong>Specialization:</strong> ${currentUser.specialization||'—'}</div>
          <div><strong>Experience:</strong> ${currentUser.experience||'—'}</div>
          <div><strong>Qualification:</strong> ${currentUser.qualification||'—'}</div>`;  
  } 
  else if(currentUser.role==='hospital'){
    html=`<div><strong>Hospital Name:</strong> ${currentUser.hospitalName||'—'}</div>
          <div><strong>License:</strong> ${currentUser.licenseH||'—'}</div>
          <div><strong>Ambulances:</strong> ${currentUser.ambulances||0}</div>
          <div><strong>ER Rooms:</strong> ${currentUser.erRooms||0}</div>
          <div><strong>Doctors Available:</strong> ${currentUser.doctorsAvailable||0}</div>
          <div><strong>Emergency Contact:</strong> ${currentUser.hphone||'—'}</div>`;  
  } 
  else if(currentUser.role==='patient'){
    html=`<div><strong>Blood Group:</strong> ${currentUser.bloodGroup||'—'}</div>
          <div><strong>Address:</strong> ${currentUser.address||'—'}</div>
          <div><strong>Health Issues:</strong> ${currentUser.healthIssues||'None'}</div>
          <div><strong>Allergies:</strong> ${currentUser.allergies||'None'}</div>
          <div><strong>Medications:</strong> ${currentUser.medications||'None'}</div>
          <div><strong>Emergency Contact:</strong> ${currentUser.emergencyContact||'—'}</div>
          <div><strong>Chronic Conditions:</strong> ${currentUser.conditions||'—'}</div>`;  
  } 
  else if(currentUser.role==='pharmacy'){
    html=`<div><strong>Pharmacy Name:</strong> ${currentUser.pharmacyName||'—'}</div>
          <div><strong>License Number:</strong> ${currentUser.drugLicense||'—'}</div>
          <div><strong>Address:</strong> ${currentUser.pharmAddress||'—'}</div>
          <div><strong>Drugs in Stock:</strong> ${currentUser.drugStock||'—'}</div>
          <div><strong>Pharmacists Available:</strong> ${currentUser.pharmacistsAvailable||0}</div>`;  
  }
  else if(currentUser.role==='transport' || currentUser.role==='driver'){
    // driver/transport single-person view
    const d = getDriverField();
    html = `
      <div class="kv"><strong>Driver Name:</strong> ${escapeHtml(d.driverName || '—')}</div>
      <div class="kv"><strong>Vehicle Type:</strong> ${escapeHtml(d.vehicleType || '—')}</div>
      <div class="kv"><strong>Number Plate:</strong> ${escapeHtml(d.numberPlate || '—')}</div>
      <div class="kv"><strong>Driving License:</strong> ${escapeHtml(d.drivingLicense || '—')}</div>
      <div class="kv"><strong>NID / ID:</strong> ${escapeHtml(d.nidNumber || '—')}</div>
      <div class="kv"><strong>Address:</strong> ${escapeHtml(d.address || '—')}</div>
    `;
  }

  extraFields.innerHTML = html;
}

// render role-specific fields in the edit form (right panel)
function renderRoleFields(role){
  let html='';

  if(role==='admin'){
    html=`<div style="margin-top:10px">
            <label>System Access Level</label>
            <input type="text" value="Full Admin Privileges" readonly>
          </div>
          <div style="margin-top:10px">
            <label>All Users</label>
            <textarea readonly style="height:120px;">${users.map(u=>u.name+' ('+u.role+')').join('\n')}</textarea>
          </div>`;  
  }
  else if(role==='doctor'){
    html=`<div class="grid-2">
            <div><label>Specialization</label><input type="text" id="f_spec" value="${escapeAttr(currentUser.specialization||'')}"></div>
            <div><label>Experience</label><input type="text" id="f_exp" value="${escapeAttr(currentUser.experience||'')}"></div>
          </div>
          <div style="margin-top:10px">
            <label>Qualification</label>
            <input type="text" id="f_qual" value="${escapeAttr(currentUser.qualification||'')}" placeholder="Degree / University">
          </div>`;
  } 
  else if(role==='hospital'){
    html=`<div class="grid-2">
            <div><label>Hospital Name</label><input type="text" id="f_hname" value="${escapeAttr(currentUser.hospitalName||'')}" readonly></div>
            <div><label>License Number</label><input type="text" id="f_license" value="${escapeAttr(currentUser.licenseH||'')}" readonly></div>
          </div>
          <div class="grid-2" style="margin-top:10px">
            <div><label>Number of Ambulances</label><input type="number" id="f_ambulances" value="${currentUser.ambulances||0}"></div>
            <div><label>Emergency Rooms Available</label><input type="number" id="f_errooms" value="${currentUser.erRooms||0}"></div>
          </div>
          <div class="grid-2" style="margin-top:10px">
            <div><label>Doctors Available</label><input type="number" id="f_docavail" value="${currentUser.doctorsAvailable||0}"></div>
            <div><label>Emergency Contact</label><input type="tel" id="f_hphone" value="${escapeAttr(currentUser.hphone||'')}"></div>
          </div>`;
  } 
  else if(role==='patient'){
    html=`<div class="grid-2" style="margin-top:12px">
            <div>
              <label>Blood Group</label>
              <input type="text" id="f_blood" value="${escapeAttr(currentUser.bloodGroup||'')}">
            </div>
            <div>
              <label>Emergency Contact</label>
              <input type="tel" id="f_emergency" value="${escapeAttr(currentUser.emergencyContact||'')}">
            </div>
          </div>
          <div style="margin-top:10px">
            <label>Health Issues</label>
            <textarea id="f_health">${escapeHtml(currentUser.healthIssues||'')}</textarea>
          </div>
          <div style="margin-top:10px">
            <label>Allergies</label>
            <textarea id="f_allergies">${escapeHtml(currentUser.allergies||'')}</textarea>
          </div>
          <div style="margin-top:10px">
            <label>Current Medications</label>
            <textarea id="f_meds">${escapeHtml(currentUser.medications||'')}</textarea>
          </div>
          <div style="margin-top:10px">
            <label>Chronic Conditions / BP</label>
            <textarea id="f_conditions">${escapeHtml(currentUser.conditions||'')}</textarea>
          </div>`;
  } 
  else if(role==='pharmacy'){
    html=`<div class="grid-2">
            <div><label>Pharmacy Name</label><input type="text" value="${escapeAttr(currentUser.pharmacyName||'')}" readonly></div>
            <div><label>License Number</label><input type="text" value="${escapeAttr(currentUser.drugLicense||'')}" readonly></div>
          </div>
          <div class="grid-2" style="margin-top:10px">
            <div><label>Drugs in Stock</label><input type="text" id="f_drugstock" value="${escapeAttr(currentUser.drugStock||'')}"></div>
            <div><label>Pharmacists Available</label><input type="number" id="f_pharmavail" value="${currentUser.pharmacistsAvailable||0}"></div>
          </div>
          <div style="margin-top:10px">
            <label>Address</label>
            <input type="text" id="f_pharmaddress" value="${escapeAttr(currentUser.pharmAddress||'')}">
          </div>`;
  }
  else if(role==='transport' || role==='driver'){
    // Transport / Driver single-person fields (editable)
    const d = getDriverField();
    html = `
      <div class="grid-2">
        <div>
          <label>Driver Name</label>
          <input type="text" id="f_driverName" value="${escapeAttr(d.driverName||'')}">
        </div>
        <div>
          <label>Vehicle Type</label>
          <input type="text" id="f_vehicleType" value="${escapeAttr(d.vehicleType||'')}" placeholder="Bike / Car / Ambulance">
        </div>
      </div>

      <div class="grid-2" style="margin-top:10px">
        <div>
          <label>Number Plate</label>
          <input type="text" id="f_numberPlate" value="${escapeAttr(d.numberPlate||'')}">
        </div>
        <div>
          <label>Driving License</label>
          <input type="text" id="f_drivingLicense" value="${escapeAttr(d.drivingLicense||'')}">
        </div>
      </div>

      <div class="grid-2" style="margin-top:10px">
        <div>
          <label>NID / National ID</label>
          <input type="text" id="f_nid" value="${escapeAttr(d.nidNumber||'')}">
        </div>
        <div>
          <label>Address</label>
          <input type="text" id="f_address" value="${escapeAttr(d.address||'')}">
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Location Sharing</label>
        <select id="f_locationShare">
          <option value="ON" ${((currentUser.locationShare==='ON' || currentUser.locationShare==='on')?'selected':'')}>ON</option>
          <option value="OFF" ${((currentUser.locationShare==='OFF' || currentUser.locationShare==='off')?'selected':'')}>OFF</option>
        </select>
      </div>
    `;
  }

  roleFieldsContainer.innerHTML = html;
}

// escape helpers to avoid breaking injected values in attributes/textareas
function escapeAttr(str){
  if(!str && str!==0) return '';
  return String(str).replace(/"/g, '&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
function escapeHtml(str){
  if(!str && str!==0) return '';
  return String(str).replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function populateForm(){
  inpName.value = currentUser.name || currentUser.driverName || '';
  inpRole.value = currentUser.role || '';
  inpPhone.value = currentUser.phone || '';
  inpEmail.value = currentUser.email || '';
  renderRoleFields(currentUser.role);
}

function saveCurrent(){
  const idx = users.findIndex(u=> (u.id && u.id===currentUser.id) || (u.userId && u.userId===currentUser.userId) );
  if(idx>-1){
    users[idx]=currentUser;
    saveUsers(users);
    refreshSummary();
  } else {
    // fallback - try to update by matching email
    const byEmail = users.findIndex(u => u.email && currentUser.email && u.email === currentUser.email);
    if(byEmail>-1){ users[byEmail]=currentUser; saveUsers(users); refreshSummary(); }
  }
}

// ------------------- Event Listeners -------------------
inpPic.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload=function(){ currentUser.profilePic=reader.result; saveCurrent(); showMessage('Profile picture updated','success'); }
  reader.readAsDataURL(f);
});

saveProfileBtn.addEventListener('click', ()=>{
  // Basic fields
  currentUser.name = inpName.value.trim();
  currentUser.phone = inpPhone.value.trim();

  // Role specific
  if(currentUser.role==='doctor'){
    currentUser.specialization = (document.getElementById('f_spec') || {}).value?.trim() || currentUser.specialization;
    currentUser.experience = (document.getElementById('f_exp') || {}).value?.trim() || currentUser.experience;
    currentUser.qualification = (document.getElementById('f_qual') || {}).value?.trim() || currentUser.qualification;
  } else if(currentUser.role==='hospital'){
    currentUser.ambulances = parseInt((document.getElementById('f_ambulances') || {}).value) || currentUser.ambulances || 0;
    currentUser.erRooms = parseInt((document.getElementById('f_errooms') || {}).value) || currentUser.erRooms || 0;
    currentUser.doctorsAvailable = parseInt((document.getElementById('f_docavail') || {}).value) || currentUser.doctorsAvailable || 0;
    currentUser.hphone = (document.getElementById('f_hphone') || {}).value?.trim() || currentUser.hphone;
  } else if(currentUser.role==='patient'){
    currentUser.bloodGroup = (document.getElementById('f_blood') || {}).value?.trim() || currentUser.bloodGroup;
    currentUser.emergencyContact = (document.getElementById('f_emergency') || {}).value?.trim() || currentUser.emergencyContact;
    currentUser.healthIssues = (document.getElementById('f_health') || {}).value?.trim() || currentUser.healthIssues;
    currentUser.allergies = (document.getElementById('f_allergies') || {}).value?.trim() || currentUser.allergies;
    currentUser.medications = (document.getElementById('f_meds') || {}).value?.trim() || currentUser.medications;
    currentUser.conditions = (document.getElementById('f_conditions') || {}).value?.trim() || currentUser.conditions;
  } else if(currentUser.role==='pharmacy'){
    currentUser.drugStock = (document.getElementById('f_drugstock') || {}).value?.trim() || currentUser.drugStock;
    currentUser.pharmacistsAvailable = parseInt((document.getElementById('f_pharmavail') || {}).value) || currentUser.pharmacistsAvailable || 0;
    currentUser.pharmAddress = (document.getElementById('f_pharmaddress') || {}).value?.trim() || currentUser.pharmAddress;
  } else if(currentUser.role==='transport' || currentUser.role==='driver'){
    // Save canonical driver keys (so future code can rely on these)
    currentUser.driverName = (document.getElementById('f_driverName') || {}).value?.trim() || currentUser.driverName || currentUser.name;
    currentUser.vehicleType = (document.getElementById('f_vehicleType') || {}).value?.trim() || currentUser.vehicleType;
    currentUser.numberPlate = (document.getElementById('f_numberPlate') || {}).value?.trim() || currentUser.numberPlate;
    currentUser.drivingLicense = (document.getElementById('f_drivingLicense') || {}).value?.trim() || currentUser.drivingLicense;
    currentUser.nidNumber = (document.getElementById('f_nid') || {}).value?.trim() || currentUser.nidNumber;
    currentUser.address = (document.getElementById('f_address') || {}).value?.trim() || currentUser.address;
    currentUser.locationShare = (document.getElementById('f_locationShare') || {}).value || currentUser.locationShare || 'OFF';
  }

  saveCurrent();
  showMessage('Profile saved successfully!','success');
});

// Cancel => re-populate values (discard edits)
cancelEditBtn.addEventListener('click', populateForm);

// scroll-to-edit
editBtn.addEventListener('click', ()=>{ window.scrollTo({top:0, behavior:'smooth'}); profileFormCard.scrollIntoView(); });

// Dashboard button
dashboardBtn.addEventListener('click', ()=>{
  const role = currentUser.role || 'user';
  if(role.toLowerCase() === 'admin'){
    window.location.href='./admin-dashboard.html';
  } else {
    window.location.href='./dashboard.html';
  }
});


// HIDE DELETE BUTTON FOR ADMIN
if(currentUser.role === 'admin'){
  deleteBtn.style.display = 'none';
}

// Logout
logoutBtn.addEventListener('click', ()=>{ localStorage.removeItem('quickAidCurrent'); window.location.href = 'join.html'; });

// Delete inline card actions
deleteBtn.addEventListener('click', ()=>{ deleteCard.style.display='block'; deleteCard.scrollIntoView({behavior:'smooth'}); });
cancelDeleteInline.addEventListener('click', ()=>{ deleteCard.style.display='none'; });
confirmDeleteInline.addEventListener('click', ()=>{
  users = users.filter(u => u.id !== currentUser.id && u.userId !== currentUser.userId);
  saveUsers(users);
  localStorage.removeItem('quickAidCurrent');
  showMessage('Account deleted successfully!','success');
  setTimeout(()=>{ window.location.href='join.html'; }, 1500);
});

// ------------------- Initialize -------------------
populateForm();
refreshSummary();
</script>

</body>
</html>
