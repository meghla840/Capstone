<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login – QuickAid</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    body { font-family: 'Merriweather', serif; background: #eaf0f3; margin: 0; padding: 0; }
    header { background: #49465b; color: white; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: center; position: sticky; top: 0; z-index: 1000; }
    header i { font-size: 1.4rem; cursor: pointer; position: absolute; left: 20px; }
    header h1 { margin: 0; font-size: 1.4rem; font-weight: 600; text-align: center; width: 100%; }
    .card { max-width: 500px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 6px 15px rgba(0,0,0,0.15); text-align: center; }
    h2 { font-size: 1.8rem; color: #49465b; margin-bottom: 1.5rem; }
    input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; font-family: 'Merriweather', serif; font-size: 1rem; }
    button { background: #49465b; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: 600; margin-top: 10px; }
    button:hover { background: #6c6a81; }
    .signup-link { text-align: center; margin-top: 1rem; }
    .signup-link a { color: #49465b; font-weight: 700; text-decoration: none; }
    .signup-link a:hover { text-decoration: underline; }
    .message { margin-top: 10px; font-weight: 600; }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
</style>
</head>

<body>

<header>
    <i class="bi bi-arrow-left" onclick="history.back()"></i>
    <h1>Login</h1>
</header>

<div class="card">
    <h2>Welcome Back</h2>

    <form id="loginForm">
        <input type="text" id="loginId" placeholder="Email or Phone" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
        <div class="message" id="loginMessage"></div>
        <div class="signup-link">
            Don't have an account? <a href="join.html">Join Now</a>
        </div>
    </form>
</div>

<script>
// ----------------- Utility Functions -----------------
function readUsers() { 
    return JSON.parse(localStorage.getItem('quickAidUsers') || '[]'); 
}
function saveUsers(users) { 
    localStorage.setItem('quickAidUsers', JSON.stringify(users)); 
}

// ----------------- Ensure Admin Exists -----------------
let users = readUsers();
if (!users.some(u => u.email === 'admin@quickaid.com')) {

    const admin = { 
        id: 'admin_1',
        name: 'Admin',
        email: 'admin@quickaid.com',
        phone: '0000000000',
        password: 'admin123',
        role: 'Admin',
        pic: "", 
    };

    users.push(admin);
    saveUsers(users);
}

// ----------------- Login Logic -----------------
document.getElementById('loginForm').addEventListener('submit', function(e){
    e.preventDefault();

    const loginId = document.getElementById('loginId').value.trim();
    const loginPass = document.getElementById('loginPassword').value.trim();
    const messageDiv = document.getElementById('loginMessage');

    users = readUsers();

    let loggedUser = users.find(u => 
        (u.email === loginId || u.phone === loginId) && u.password === loginPass
    );

    if (loggedUser) {

        // Ensure ID exists
        if (!loggedUser.id) loggedUser.id = 'user_' + Date.now();

        // Save updated users list
        const idx = users.findIndex(u => u.email === loggedUser.email);
        if (idx !== -1) users[idx] = loggedUser;
        saveUsers(users);

        // ---- ✔ FIX: Save Logged User as quickAidUser for UI toggle ----
        const quickUser = {
            username: loggedUser.name,
            position: loggedUser.role || "User",
            pic: loggedUser.pic || "https://cdn-icons-png.flaticon.com/512/149/149071.png",
            id: loggedUser.id
        };

        localStorage.setItem("quickAidUser", JSON.stringify(quickUser));

        // Also save "current session"
        localStorage.setItem("quickAidCurrent", loggedUser.id);

        messageDiv.textContent = "✅ Login Successful! Redirecting...";
        messageDiv.className = "message success";

        setTimeout(()=>{ window.location.href='index.html'; }, 800);

    } else {
        messageDiv.textContent = "❌ Invalid Email/Phone or Password!";
        messageDiv.className = "message error";
    }
});
</script>


</body>
</html>
